# KrugQx

## Files needed for Qx

Qx runs on four main genotype input files. 

### Two of these revolve around the GWAS hits. 

* gwas.data.file: GWAS effect estimates from the GWAS panel. Format:
		
		Name, Allele1, Allele2, Effect, Freq
* freqs.file: allele frequencies and other attributes of the GWAS hits in the test populations. Format:

		Name, CLST, A1, A2, Freq, vars
		
	where `CLST` denotes the population and `vars` are variables to match for the null SNPs. Tim just uses frequency. For the NAM data, we could also use whether the positive effect of major allele came from B73.
	
### Two are the 'genome' files for all SNPs.

* full.dataset.file: all allele frequencies in all populations, similar in format to freqs.file
* match.pop.file:  the frequencies and matching attributes of all SNPs in the GWAS panel.

### Qx also uses an environmental variables file.

Of the format `CLUST,ENV,REG`. `REG` corresponds to geographic clusters and can be ignored as we aren't interested in a regional Z score. 

Notes:

* The allele frequencies are the frequencies of allele A1
* The effects are the substitution effects of replacing A2 with A1.

## Task: Getting the NAM allele frequencies

### Important files

#####For these files, both Kate and I keyed off of SNP ID, which are based on genome v2 coordinates. This means we can use the ID's to match with Krug positions, which are also on v2.

* /data/Namfreqs/alleles.txt  
	* Contains ID, Ref, and Alt for all the GbS alleles in the NAM progeny
	* Generated by /scripts/getalleles.sh.
	* Contains output for `954794` SNPs.
* /data/Namfreqs/frequencies_chr*.csv
	* Contains allele frequencies for SNPs in the NAM population
	* Generated by ./scripts/allelefreqs.R
	* Contains allele frequencies for `514253` SNPs.
* /scripts/check_nam_alleles.py:
	* combines the output from the above scripts to make sure allele frequencies are mapped to the correct alleles. 
	* generates allfreqs.csv

Some notes on the R datasets used by allelefreqs.R:
	
		in a column you have a locus, 0, 1 or 2
		S10_148970904_T is header
		for example
		0=majorhomo
		1=Tmajor (het)
		2 = TT
 
So the underscore allele is the minor allele that the frequency has been calculated for. To match the format of the Qx scripts, I should make A1 the underscore allele.

###Step 1: Get the alleles and frequencies for the match.pop file

#####Get the alleles Kate mapped onto NAM
The file is: `../data/Namfreqs/NAM_allfreqs.csv`

It contains `511532` SNPs

	./scripts/getalleles.sh > ./data/Namfreqs/alleles.txt
	./scripts/build_namalleles.py > ./data/Namfreqs/alleledict.pkl
	./scripts/check_namalleles.py > ./data/Namfreqs/NAM_allfreqs.csv

#####Get the overlap with Krug
The overlap is roughly 23,000 SNPs. Not a lot to go on. Script with this assessment is
 
	./scripts/krug_nam_overlap.rmd

This script also generates files with only the overlapping SNPs:

	./data/NAM_freqs_olap_krug.csv
	./data/Krug/freqs_olap.csv

Next, I need to figure out if the allele tracked in NAM is the allele tracked in Krug.

#####Calculate allele frequencies among NAM parents

Get the NAM parent names by subtracting `keep_list_NAM_children.txt` from `keep_list_NAM.txt`

	fgrep -x -f keep_list_NAM_children.txt -v keep_list_NAM.txt |
	grep -v -i "Blank\|B73x" > NAM_Parents.txt
	
	